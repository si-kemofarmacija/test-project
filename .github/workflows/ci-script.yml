---
name: CI for hello.sh
on:
  push:
    branches:
      - main
jobs:
  test-script:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
      - name: Capture Assigned Hostname
        run: |
          echo "$(hostname)"
          echo "ACTUAL_HOSTNAME=$(hostname)" >> $GITHUB_ENV
      - name: Verify Hostname Output
        run: |
          cd test
          echo "Expected Hostname: $ACTUAL_HOSTNAME"
          chmod +x hello.sh
          OUTPUT=$(timeout 1s ./hello.sh)
          echo "Script Output: $OUTPUT"

          if [[ -z "$OUTPUT" ]]; then
            echo "No output from hello.sh."
            exit 1
          fi

          if echo "$OUTPUT" | grep -q "Hello from $ACTUAL_HOSTNAME"; then
            echo "Hostname output is correct."
          else
            echo "Hostname output is incorrect."
            exit 1
          fi
